\begin{comment}
  \bibliography{project.bib}
\end{comment}

\chapter{Digital Color}
\label{cha:color}

\begin{refsection}

  \section{Color Models}
  \label{sec:color-models}

  \subsection{What Is Color?}
  \label{sec:what-color}

  \newcommand{\bluewave}{\ensuremath{\SI{400}{\nano\meter}}}

  Light is composed of tiny particles traveling at different
  wavelengths\index{wavelength}. \cite{neider93:_openg_progr_guide}.
  Different colors are light traveling at different wavelengths. For
  example, blue has a wavelength of
  \bluewave \cite{ohlsson99:_digit_bild_kreat}.

  But how do our eyes \textit{see} these light waves? In our eyes,
  there are cells for perceiving three different kinds of wavelengths
  of light: red, blue and green. When these cells absorb red,green or
  blue light, we see color. And when these cells absorb mixed amounts
  of red, blue and green light, we are able to perceive \textit{all}
  the other possible colors.

  \subsection{RGB}
  \label{sec:rgb}

  Color models\index{color model} are ways of specifying colors
  numerically \cite{fadgi11:color_model}. A very widely used color
  model for representing color in computers is \textbf{RGB}\index{RGB}.

  \begin{figure}
    \centering
    \inputtikz{rgb.tex}
    \caption{The RGB color model}
    \label{fig:rgb}
  \end{figure}

  The color model is, of course, based on how our eyes perceive color,
  as mentioned in section \ref{sec:what-color}. As it can be seen in
  figure \ref{fig:rgb}, the colors cyan ,magenta and yellow can
  be achieved by mixing either red, blue and green. Also note that
  white is achieved by mixing all of three colors. Black is
  represented by no light at all. The rest of the colors can be
  achieved by mixing different amounts of red,green and blue.

  The RGB color model is called additive\index{additive color model}
  because it makes different colors by adding together light.

  The different amounts of red, green and blue in a color, are called
  their respective color channels\index{color channel}.

  \subsection{CMYK}
  \label{sec:cmyk}

  Instead of mixing light,we can spread color out on paper to make all
  the different colors. Doing this, we have created a new color model:
  \textbf{CMYK}\index{CMYK}. It stands for \textbf{C}yan,
  \textbf{M}agenta, \textbf{Y}ellow and blac\textbf{K}.

  It is subtractive\index{subtractive color model}, meaning that
  instead of adding light, we subtract the light by adding more and
  more ink to the paper.

  \subsection{Alpha Channels}
  \label{sec:alpha_chan}

  But there is actually even more to RGB. There is an extended color
  model of RGB that's called RGBA \index{RGBA}. In this model, a new channel is
  added: the alpha channel\index{alpha channel}. This new channel
  represents the opacity of a color. Opacity is simply the opposite of
  transparency \cite{porter84_compos_dig_img}. Take
  a good look at figure \ref{fig:alpha}.

  It demonstrates how a the color blue gets a lower and lower value of
  its alpha channel until it turns transparent. In the leftmost part,
  the color has its maximum possible alpha channel value, meaning that it's
  fully visible. On the other hand, the leftmost color has its lowest
  possible alpha value, $0$, and as a result is fully transparent.

  \begin{figure}
    \centering
    \inputtikz{alpha.tex}
    \caption{The color blue with an increasingly lower alpha channel.}
    \label{fig:alpha}
  \end{figure}

  \section{Color Depth}
  \label{sec:color-depth}


  But up until now, I have said nothing about how the computer
  represents these color models. Let us start with:

  \subsection{24-bit Color}
  \label{sec:24-bit-color}

  In the RGB color model, each color is just a combination red,green
  and blue channels. So let us represent colors as a triple of three
  numbers, like this: \rgbtrip{123}{21}{91}, which is
  \textcolor[RGB]{123,21,91}{this color}.

  An 8-bit number has, as you should be familiar with, only $2^8 =
  256$ possible values. If we assign an 8-bit number to each color
  channel, the total size of a single color will be 24-bits. This way
  of representing color is called 24-bit color\index{24-bit
    color}. You also say that its color depth\index{color depth} is 24-bits.

  \newcommand{\selfcolor}[1]{\textcolor{#1}{#1}}

  A full \selfcolor{red} color is represented by the triple \rgbtrip{255}{0}{0}. In
  that case, have a guess at what color is represented by
  \rgbtrip{255}{0}{255}. If haven't guessed it already, please study
  figure \ref{fig:rgb}. As you probably already have guessed, this color
  is \selfcolor{yellow}. And in the same number mixing and matching way, many other
  colors can be represented. See table \ref{tab:color-examples} for
  examples of other color values.

  \begin{table}
    \newcommand{\colorrow}[4]{  \rgbtrip{#1}{#2}{#3} &
      \textcolor[RGB]{#1,#2,#3}{#4} \\}
    \centering
    \begin{tabular}{lr}
      \toprule
      RGB triple & Resulting color \\
      \midrule
      \colorrow{255}{215}{0}{Gold}
      \colorrow{165}{42}{42}{Brown}
      \colorrow{255}{0}{255}{Purple}
      \colorrow{255}{192}{203}{Pink}
      \colorrow{255}{165}{0}{Orange}
      \colorrow{0}{0}{139}{Dark Blue}
      \colorrow{105}{105}{105}{Dim Grey}
      \colorrow{0}{100}{0}{Dark Green}
      \colorrow{205}{92}{92}{Indian Red}
      \bottomrule
    \end{tabular}
    \caption{Colors}
    \label{tab:color-examples}
  \end{table}

  But of course, not all colors can be represented using just
  24 bits. The number of \textit{all} possible colors is infinite. But you can still
  represent an awful not colors with only 24-bits. How many? Well, every
  color channel can have $256$ different values. There are $3$
  channels. Hence, there are $256^3 = 16777216$ different colors that
  can represented using only 24-bits!

  \newcommand{\rgbaquad}[4]{
    \mbox{(\textcolor{red}{#1},\textcolor{green}{#2},\textcolor{blue}{#3},\textcolor{gray}{#4})}}

  Adding alpha channels to this color representation is trivial, just
  add a fourth channel and 8-bit number. The only real
  difference is that a color will require 32-bits of storage if an
  alpha channel is needed.

  \subsection{Grayscale}
  \label{sec:other-colors-depths}

  \newcommand{\selfrgbtrip}[3]{\mbox{\textcolor[RGB]{#1,#2,#3}{(#1,#2,#3)}}}
  \newcommand{\selfrgbtripgray}[1]{\selfrgbtrip{#1}{#1}{#1}}

  If every color channel of a RGB color is set to the same value, the
  resulting color will be a grayscale color\index{grayscale
    color}. Using 24-bit color, we can for example make the following
  grayscales:
  \selfrgbtripgray{100},\selfrgbtripgray{210},\selfrgbtripgray{60}. Using
  24-bits you can really only represent 256 different possible
  grayscale colors because $256$ is how many different values can be
  represented by an 8-bit number. So if we assign each of these RGB
  triples to an 8-bit number, we have thus invented 8-bit
  grayscale\index{8-bit grayscale}! So in this system, the number 80
  would represent the color \selfrgbtripgray{80}, 180 would represent
  \selfrgbtripgray{180}, and so on \cite{puglia00:_handbook_dig_proj}.

  8-bit grayscale means that we have $2^8=256$ different shades of
  gray. This system is actually applicable to any bit count, as is
  demonstrated in table \ref{tab:grayscale}. You will probably meet at least one of
  these grayscale color depths out in the wild.

  \begin{table}
    \centering
    \begin{tabular}{ll}
      \toprule
      Bit count & Possible shades of gray \\
      \midrule
      $2$ & $2^2 = 4$ \\
      $4$ & $2^4 = 16$ \\
      $8$ & $2^8 = 256$ \\
      $16$ & $2^{16} = 65536$ \\
      \bottomrule
    \end{tabular}
    \caption{Different bit counts of grayscale}
    \label{tab:grayscale}
  \end{table}

  \section{Parsing Color Data}
  \label{sec:parsing-color-data}

  A random 8-bit number, for example, could be written as a string of
  ones and zeroes, 00011010. From now on we will refer to such a
  string as a bit pattern.

  Color is specified by bit ranges in numbers of certain
  sizes. So how do we extract these bits? That is what are going to
  discuss in the section.

  \subsection{Grayscale}

  The most trivial color type to parse is grayscale color. Since a
  grayscale color is specified by just one number, there's no need to
  do any parsing. As we discussed before, the number $x$ specifies the
  grayscale color \mbox{($x,x,x$)}. \todo{discuss different bit depths
    of grayscale}

  \subsection{RGB(A) Color}

  Things do however become more interesting when we try to parse RGB
  and RGBA color. There are several bit depths possible for RGB
  color but we'll only be covering some of the most common ones.

  In all of these algorithms we'll be using the variable $data$ to
  represent the color value we want to parse.

  \subsubsection{24-bit color}

  \begin{figure}
    \centering
    {\huge\textcolor{red}{10001011}\textcolor{green}{01010010}\textcolor{blue}{\fullbyte}}
    \label{fig:24-bit-colors-bits}
    \caption{The RGB bit pattern for this \textcolor[HTML]{8B52FF}{purple color}.}
  \end{figure}

  Inspect figure \ref{fig:24-bit-colors-bits}. It shows how the
  different color channel's values are stored in 24-bit RGB
  color. Algorithm \ref{alg:read-24-bit-rgb} demonstrates how to read
  all the separate color channels. It basically works like this:

  \begin{algorithm}[H]
    \caption{Reading the color channels of RGB 24-bit number.}
    \label{alg:read-24-bit-rgb}
    \begin{algorithmic}[1]
      \Let{$B$}{$data \BitAnd 255$}
      \Let{$G$}{$(data \BitAnd (255 \ShiftLeft 8)) \ShiftRight 8$}
      \Let{$R$}{$(data \BitAnd (255 \ShiftLeft 16)) \ShiftRight 16$}
    \end{algorithmic}
  \end{algorithm}

  $255$'s binary pattern is binary \fullbyte. That means we can get
  the value of the blue color channel like this:

  \begin{center}
    \begin{tabular}{*{4}{c}}

      & 10001011  & 01010010  & \fullbyte  \\
      $\BitAnd$ &    \emptybyte&  \emptybyte  & \fullbyte \\
      \hline
      & \emptybyte & \emptybyte & \fullbyte \\
    \end{tabular}
  \end{center}

  For getting the value of the next color channel we'll need a new
  value. The operations $255 \ShiftLeft 8$ results in the formerly
  used byte pattern being shifted 8 bits forwards. This pattern we can
  used for matching the green color channel.

  \begin{center}
    \begin{tabular}{*{4}{c}}

      & 10001011  & 01010010  & \fullbyte  \\
      $\BitAnd$ &    \emptybyte&  \fullbyte  & \emptybyte \\
      \hline
      & \emptybyte & 01010010 & \emptybyte \\
    \end{tabular}
  \end{center}

  But the resulting value will have to have right shifted back 8 bits,
  otherwise it'd be $2^8$ times big as its actual value! And
  therefore, the operation to get the value of the green color channel
  is $(data \BitAnd (255 \ShiftLeft 8)) \ShiftRight 8$. And in same
  way the operation for getting the value of the red channel can be
  derived: $(data \BitAnd (255 \ShiftLeft 16)) \ShiftRight 16$.

  \subsubsection{32-bit color}

  32-bit color is very much like 24-bit color. But the alpha channel
  can either come before the RGB color values, ARGB\index{ARGB}, or
  they can occur after the RGB color values, RGBA\index{RGBA}. Figure
  \ref{fig:32-bit-colors-bits} shows both the variants. The first one
  is ARGB och the second one RGBA. In algorithm
  \ref{alg:read-32-bit-rgb} we show how to parse the first variant,
  ARGB, but do keep in mind that both variants occur out in the wild.

  \begin{figure}
    \centering
    {\huge%
      \textcolor{gray}{11110000}%
      \textcolor{red}{10001011}%
      \textcolor{green}{01010010}%
      \textcolor{blue}{\fullbyte}}
    {\huge%
      \textcolor{red}{10001011}%
      \textcolor{green}{01010010}%
      \textcolor{blue}{\fullbyte}%
      \textcolor{gray}{11110000}%
    }

    \label{fig:32-bit-colors-bits}
    \caption{The ARGB and RGBA color depths.}
  \end{figure}

  \begin{algorithm}[H]
    \caption{Reading the color channels of ARGB 32-bit number.}
    \label{alg:read-32-bit-rgb}
    \begin{algorithmic}[1]
      \Let{$B$}{$data \BitAnd 255$}
      \Let{$G$}{$(data \BitAnd (255 \ShiftLeft 8)) \ShiftRight 8$}
      \Let{$R$}{$(data \BitAnd (255 \ShiftLeft 16)) \ShiftRight 16$}
      \Let{$A$}{$(data \BitAnd (255 \ShiftLeft 24)) \ShiftRight 24$}
    \end{algorithmic}
  \end{algorithm}

  \subsubsection{16-bit color}

  \paragraph{TGA version}

  The kind of 16-bit color available in the TGA format is shown in
  figure \ref{fig:tga-16-bit-colors-bits}. And it can be trivially
  parsed with algorithm \ref{alg:read-32-bit-rgb}. What is unsual here is that the values of the
  color channel's are stored in 5-bit number, meaning that the bit
  pattern $2^5 - 1 =$  11111 is used. The last bit a basically boolean
  flag that specifies whether or not the color is visible.

  \begin{figure}
    \centering
    {\huge\textcolor{gray}{0}%
      \textcolor{red}{10101}\textcolor{green}{11100}\textcolor{blue}{01010}}
    \label{fig:tga-16-bit-colors-bits}
    \caption{Sample 16-bit color.}
  \end{figure}

  \begin{algorithm}[H]
    \caption{Reading TGA 16-bit number.}
    \label{alg:read-32-bit-rgb}
    \begin{algorithmic}[1]
      \Let{$B$}{$data \BitAnd 31$}
      \Let{$G$}{$(data \BitAnd (31 \ShiftLeft 5)) \ShiftRight 5$}
      \Let{$R$}{$(data \BitAnd (31 \ShiftLeft 10)) \ShiftRight 10$}
      \Let{$A$}{$(data \BitAnd (1 \ShiftLeft 16)) \ShiftRight 16$}
    \end{algorithmic}
  \end{algorithm}


  \printbibliography[heading=subbibliography]
\end{refsection}
