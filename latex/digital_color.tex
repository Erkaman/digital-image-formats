\begin{comment}
  \bibliography{project.bib}
\end{comment}

\chapter{Digital Color}
\label{cha:color}

% opponent process
% http://en.wikipedia.org/wiki/Opponent_process#cite_note-2

% standard rgb color spaces.pdf for color spaces, values xy whitepoint

% cotton color!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!11
% important quote in section 1.2
% mention rgb amd the color space that artists use a example of this.

% http://www.w3.org/Conferences/WWW4/Papers/53/gq-gamut.html#fncol

% file:///home/eric/Dropbox/freebooks/netghost.narod.ru/gff/graphics/book/ch02_01.htm

% file:///home/eric/Dropbox/freebooks/netghost.narod.ru/gff/graphics/book/ch02_02.htm

% Here, the extra bit is given to the green component, because the
% human eye is more sensitive to green than it is to red and blue. The
% color component order is arbitrary, and the order and interpretation
% of the color components within a pixel value varies from format to
% format. Thus, components of a 16-bit pixel value may be interpreted
% as (G,B,R) just as readily as (R,G,B) and (B,R,G). Specifying RGB
% colors in the sequence (R,G,B) has some appeal, because the colors
% are arranged by electromagnetic frequency, establishing their order
% in the physical spectrum.

% file:///home/eric/Dropbox/freebooks/netghost.narod.ru/gff/graphics/book/ch02_03.htm

% alpha%
% file:///home/eric/Dropbox/freebooks/netghost.narod.ru/gff/graphics/book/ch02_04.htm

%\cite{niederst1999webdesign}

% useful glossary.
% http://tigger.uic.edu/~hilbert/Glossary.html#Brightness

% Charles Poynton - Color technology. list of poyntons writings on color
% http://www.poynton.com/Poynton-color.html

% great source of papers.
% http://www.student.cs.uwaterloo.ca/~cs781/

% ``The colour gamut of a sample monitor (an HP A1097C)''
% http://www.w3.org/Conferences/WWW4/Papers/53/hp3.png

% the trichromatics color theory
% the opponent theory.

% GREAT walkthough of the trichromatic color theory, the eye, and the
% CIE color spaces.
%\cite{Cotton95colour}

% encylopedia.
% http://netghost.narod.ru/gff/graphics/book/ch02_02.htm

% There are two theories of how color is represented: the theory of the
% trichromacy of color and the opponent theory. This chapter deals with
% both of these theories and then explains how these theories are
% applied in the digital representation of color.

As I stated in the introduction, raster graphics is going to be the
main subject of this book. And images represented as raster graphics
is simply a grid of colors. Therefore, in this chapter well discuss
how these color are represented. First I'll discuss color in more
scientific and biological perspective, then I'll explain how color is
represented digitally and last I'll cover how to properly interpret
and parse these numbers.

\section{What is color?}

\subsection{A biological sensation}

\newcommand{\bluewave}{\ensuremath{\SI{400}{\nano\meter}}}

Color is unlike temperature not a physical property we can assign
things in the world. While it may seem easy for you to call a lamp
red, you must also consider the color this lamp from the view of
non-humans. Animals like dogs, squirrels and rabbits have a whole
different perception of color than we do. In \cite{dog_color_vision}
it was shown that dogs do indeed have a form color vision known as
dichromatic color vision. And for a Deuteranopic person(red-green
color blind person), it may be close to impossible to differentiate a
red from a green lamp, while it is to you obvious that one lamp is red
and the other is green
\cite{thompson:ways_of_coloring,schanda97:_colorimetry}.

To continue our temperate argument, I'll state that if dog and a human
both walk into fire they're both going to get burned. But on the other
hand, the color of the fire is going to be experienced differently by
these to animals. This is because color not a physical property we can
assign to objects but rather a \textit{biological
  sensation}\cite{boutel:_png_portab_networ_graph_specif_version12}. A
sensation caused by light, which is something we'll discuss in the
following section.

\subsection{The theory of the trichromacy of color}

The theory of the trichromacy of color, also known as the
Young-Helmotz theory of Trichromacy, could in plain English be stated
as: \cite{Cotton95colour,Pascale2003_ReviewRGBColourSpaces}

\begin{quote}
  Any color that can be seen by humans is a combination of three
  primary colors. Not all triplets of colors are acceptable as
  primaries , and they must satisfy the following law: none of the
  three primaries must be a combination or mixture of the other two
  primaries.
\end{quote}

The main point of this theory is that all colors us humans can see is
a combination of three base primary colors. However, do note that this
law does not apply do colorblind humans nor animals that are not
humans. We'll discuss this little detail more in depth after we have
discussed a bit theory.

\subsection{Light as color}

Light is composed of tiny particles traveling at different
wavelengths\index{wavelength} \cite{neider93:_openg_progr_guide}. When
light of different wavelengths hit out eyes, out eyes process these
wavelengths so that we \textit{perceive} these as colors. Notice how I
said perceive, because saying that we see these colors would imply
that it is a physical property and not a biological property.

Different colors we perceive as traveling at different
wavelengths. For example, blue has a wavelength of \bluewave
\cite{ohlsson99:_digit_bild_kreat}.

Now, how do our eyes \textit{see} these light waves? In our eyes,
there are cone cells for perceiving three different kinds of
wavelengths of light: red, blue and green. When these cells absorb
red, green or blue light, we see color. And when these cells absorb
mixed amounts of red, blue and green light, we are able to perceive
all the possible colors. People who are color blind typically lack one
or several of these cone cells
\cite{schanda97:_colorimetry,neider93:_openg_progr_guide}. People who
have a normal color vision has all the three cone cells, and these are
called to be standard observers and majority of ways of representing
colors are aimed at the standard observer.

\subsection{RGB}
\label{sec:rgb}

Color models\index{color model} are ways of specifying colors
numerically
\cite{hearn1997computer_graphics,Pascale2003_ReviewRGBColourSpaces}. A
very widely used color model for representing color in computers is
RGB.

\begin{figure}
  \centering
  \inputtikz{rgb.tex}
  \caption{The RGB color model}
  \label{fig:rgb}
\end{figure}

The RGB color model is based on how our eyes perceive color, which we
previous discussed in section ?. As it can be seen in figure
\ref{fig:rgb}, the colors cyan ,magenta and yellow can in this model
be achieved by mixing either red, blue and green. Also note that white
is achieved by mixing all of three colors. Black is represented by no
light at all. The rest of the colors can be achieved by mixing
different amounts of red,green and blue.

The RGB color model is called an additive\index{additive color model}
because it makes different colors by adding together light.

The different amounts of red, green and blue in a color, are called
their respective color channels\index{color channel}. These values are
represented in numbers, and how exactly this is done is discussed in
section \ref{sec:color-depth}.

\subsection{RGBA}

% png definitive guide alpha channel
% http://www.vias.org/pngguide/chapter01_03_02.html

But there is actually even more to RGB. There is an extended color
model of RGB that's called RGBA. In this model, a new channel is
added: the alpha channel\index{alpha channel}. This new channel
represents the opacity of a color. Opacity is simply the opposite of
transparency \cite{porter84_compos_dig_img,murray1996encyclopedia,niederst1999webdesign}.

Take a good look at figure \ref{fig:alpha}. This demonstrates how a
color with the same values for its red, blue and green channel, get
lower and lower value for its alpha channel. In the leftmost part of
the image the value of the alpha channel is at its maximum, so the
color is full opaque. The more to the right we get in the figure the
lower and value the alpha channel gets, and the more transparent the
color becomes as a consequence. And when the value of the alpha
channel becomes its minimum value the color turns fully transparent.

\begin{figure}
  \centering
  \inputtikz{alpha.tex}
  \caption{The color blue with an increasingly lower alpha channel.}
  \label{fig:alpha}
\end{figure}

\subsection{Device dependency and in-dependency}

RGB has the problem that it is device dependent. This is because
different devices, like printers, screens, and cameras, all define the
RGB color space differently. One screen might for example define the
maximum red as color much more red than the maximum red of another
device. It is not problem if a color is used on one single device,
because here all color is defined eqully, but since color interchange
is so extremely common it is pretty much impossible to avoid this
problem
\cite{Pascale2003_ReviewRGBColourSpaces,boutel:_png_portab_networ_graph_specif_version12}.

What is needed is a so called color management system. A color
management system a way of assuring that color is perceived the same
way on all devices. One color space that is device independent is
CIEXYZ. This color space is one of many techniques used assuring the
preservation of color appearance. But this is one convoluted color
space and the math behind it is way beyond, unfortunately. I will for
these reasons not discuss it in this text, but refer the reader who is
interested in knowing more to the sources
\cite{schanda97:_colorimetry,Pascale2003_ReviewRGBColourSpaces,boutel:_png_portab_networ_graph_specif_version12,kerr:_cie_xyz_color_spaces,Fairman_Brill_Hemmendinger_1997}.

We will also for these reasons only discuss RGB in the following
sections.


\newcommand{\rgbtrip}[3]{\mbox{(#1,#2,#3)}}

\section{Color Depth}
\label{sec:color-depth}

But up until now, I have said nothing about how the computer
numerically represents these color models. In the following section,
this is discussed for the RGB color model. The majority of the
discussion is based on \cite{murray1996encyclopedia,neider93:_openg_progr_guide,niederst1999webdesign}

\subsection{24-bit Color}
\label{sec:24-bit-color}

\subsubsection{RGB triplets}

In the RGB color model, each color is just a combination red, green
and blue color channels, So every color can be represented as a RGB
triplet: $(R, G, B)$. Since RGB triplet are specified by numbers they
are quite difficult to imagine visually, but they are on the other
hand very easy for the computer to interpret. It can trivially display
a RGB triplet on the screen by combining different ammounts of red,
blue and green light.

An 8-bit, often also called a byte number has $2^8 = 256$ different
possible values. If we assign an 8-bit number to each color channel in
the RGB triplet, the total size of a single color will be
24-bits.

This way of representing color is called 24-bit color. You also refer
to 24-bit colors as having a color depth\index{color depth} of
24-bits. This is also called the pixel depth\index{pixel depth} of the
color. Many different names have been used to refer to this value, but
we'll use the terminology color depth for the rest of this text.

Using this color depth, the maximum value of a channel will be $2^8 -
1 = 255$. So reddest of red is represented by the RGB triplet $(255,0,0)$

\begin{Exercise}[label={rgb-triplet}]
  What color does each of these RGB triplets represent: (use figure
  \ref{fig:rgb})

  \begin{enumerate}[(a)]
  \item $(0,0,255)$
  \item $(0, 255, 0)$
  \item $(255,255,0)$
  \item $(255,255,255)$
  \item $(0,0,0)$
  \item $(0,255,255)$
  \item $(255,0,255)$

  \end{enumerate}
\end{Exercise}

\subsubsection{Number instead of triplet}

the way this RGB triplet is stored in a file is simple: since every
channel in the triplet is a byte, it is stored as a sequence of 3
bytes. Since a file on a computer essentially just a sequence of
bytes, reading a byte from a file is trivial operation that is
supported by virtually every programming language in existence.

But you can also see this another way: the triplet is stored as a
24-bit number. Then the triplet $(R,G,B)$ would be stored as the
24-bit number $R \cdot 256^2 + G \cdot 256 + B$. Here the highest bits
of the number stores the red channel, the 8 middle bits store the
green channel, and the 8 lowest bits stores the blue channel, so that
the color yellow could be represented as: $(255,255,0) 255 \cdot 256^2
+ 255 \cdot 256 + 0 = 16776960$, which is equal to the binary number
$11111111\ 11111111\ 00000000$. The separate color channels can then
be extracted by using the bitwise operators. We will discuss this
later in the text, but please, try doing this on you own in the
exercise below.

n\begin{Exercise}
  Try to use the bitwise operators for extracting the separate color
  channels from a 24-bit number representing a color.

\end{Exercise}

\begin{Exercise}

  Now use the method you designed in the previous exercise for
  extracting the separate color channels out of the following 24-bit
  numbers:

\end{Exercise}

\subsubsection{Channel ordering}

As is stated in \cite{murray1996encyclopedia}, there's nothing from
stopping you from storing the color channels in another than order R,G then
B. B,G,R is order that is also commonly used. The specification of the
image format usually specifies in which order the color channels are
stored, so do remember to read the specification carefully.

\subsubsection{Good enough?}

So how many different colors can you represent using 24-bit color?
Every color channel can have $2^8 = 256$ different values and there
are $3$ channels; hence, $256^3 = 16777216 \approx 16\ 000\ 000$ different colors
can represented using 24-bits.

Then how many different colors can us humans see? Scientists do not
really know yet how many different colors us humans can see. Popular
guesses include one million \cite{roth:_tetrachromat} and $2^{24} =
256^3$ \cite{murray1996encyclopedia}. But 24 bits tends to be good
enough for most purposes.

\subsection{RGBA}

Adding alpha channels to this color representation is trivial, just
add a fourth channel by adding another 8-bit channel. So RGBA color
data is in other words stored as a quadruplet: $(R,G,B,A)$. And as I
stated before, there is absolutely nothing stopping you from storing these
channels in a different order. The $(A,R,G,B)$ and $(A,B,G,R)$ order are also
used in certain formats, to give an example.

\subsection{Other channel sizes}

Other kinds of numbers than 8-bit numbers can be assigned to the
separate channels as well. Assigning a 16-bit number to each channel
is also common, and is supported by the PNG
format\cite{boutel:_png_portab_networ_graph_specif_version12}, which
we'll discuss in chapter \ref{cha:png}. This is for obvious reasons
known as 48-bit. If an alpha channel is added to this model it is then
as 64-bit color.

In 48-bit the miaxmum value of a color channel is obvious $2^{16} - 1
= 65535$, meaning that the reddest of red is represented by the
triplet $(65535, 0, 0)$

\subsection{Grayscale Color}

\newcommand{\selfrgbtrip}[3]{\mbox{\textcolor[RGB]{#1,#2,#3}{(#1,#2,#3)}}}
\newcommand{\selfrgbtripgray}[1]{\selfrgbtrip{#1}{#1}{#1}}

If every color channel of a RGB color is set to the same value, the
resulting color will be a grayscale color. Using 24-bit color, we can for example make the following
scalwes of grey :
\selfrgbtripgray{100},\selfrgbtripgray{210},\selfrgbtripgray{60}. Using
24-bits you can really only represent 256 different possible
grayscale colors because $256$ is how many different values can be
represented by an 8-bit number. So if we assign each of these RGB
triples to an 8-bit number, we have thus invented 8-bit
grayscale\index{8-bit grayscale}! So in this system, the number 80
would represent the color \selfrgbtripgray{80}, 180 would represent
\selfrgbtripgray{180}, and so on \cite{puglia00:_handbook_dig_proj}.

8-bit grayscale means that we have $2^8=256$ different shades of
gray. This system is actually applicable to any bit count, as is
demonstrated in table \ref{tab:grayscale}. You will probably meet at least one of
these grayscale color depths out in the wild.

\begin{table}
  \centering
  \begin{tabular}{ll}
    \toprule
    Bit count & Possible shades of gray \\
    \midrule
    $2$ & $2^2 = 4$ \\
    $4$ & $2^4 = 16$ \\
    $8$ & $2^8 = 256$ \\
    $16$ & $2^{16} = 65536$ \\
    \bottomrule
  \end{tabular}
  \caption{Different bit counts of grayscale}
  \label{tab:grayscale}
\end{table}

\section{Parsing Color Data}
\label{sec:parsing-color-data}

The number $26$ as a 8-bit number could be written as a string of
ones and zeroes, 00011010. From now on we will refer to such a
string as a bit pattern\index{bit pattern}.

Color is specified by bit ranges in numbers of certain
sizes. So how do we extract these bits? That is what are going to
discuss in the section.

\subsection{Grayscale}

The most trivial color type to parse is grayscale color. Since a
grayscale color is specified by just one number, there's no need to
do any parsing. As we discussed before, the number $x$ specifies the
grayscale color \mbox{($x,x,x$)}. \todo{discuss different bit depths
  of grayscale}

\subsection{RGB(A) Color}

Things do however become more interesting when we try to parse RGB
and RGBA color. There are several bit depths possible for RGB
color but we'll only be covering some of the most common ones.

\subsubsection{24-bit color}

\begin{figure}
  \centering
  {\huge\textcolor{red}{10001011}\textcolor{green}{01010010}\textcolor{blue}{\fullbyte}
    = \textcolor[HTML]{8B52FF}{purple}}
  \caption{The RGB bit pattern for a purplish color.}
  \label{fig:24-bit-colors-bits}
\end{figure}

The number 24-bit \textcolor{red}{1000 1011}\textcolor{green}{0101
  0010}\textcolor{blue}{\fullbyte} represents a purplish color. The
separate values of the color channels of this number can trivivally
be pased by reading them byte for byte. Because, remember, the each
color channel in 24-bit number is stored in a separate
byte. Algorithm \ref{alg:read-24-bit-rgb} demonstrates how to read
all the separate color channels.

\todo{discuss endianess}

\subsubsection{16-bit color}

Colors can also be stored in 16 bits, but it is relatively
rare. There are several variants of 16-bit color storage, so we'll
be covering some of them here.

\paragraph{TGA version}

The kind of 16-bit color used in the TGA format is shown in figure
\ref{fig:tga-16-bit-colors-bits}. It can be trivially parsed as is
shown in algorithm \ref{alg:read-16-bit-rgb}. What is unsual here is
that the values of the color channel's are stored in 5-bit number,
meaning that the maximum value of a color channel in this case is
$2^5 - 1 = 31$. However, here only one bit is reserved for the alpha
channel. A better name for this bit would a flag. And what this flag
is specify whether a color is visible or not.

\begin{figure}
  \centering
  {\huge\textcolor{gray}{0}%
    \textcolor{red}{10101}\textcolor{green}{11100}\textcolor{blue}{01010}}
  \caption{Sample 16-bit color.}
  \label{fig:tga-16-bit-colors-bits}
\end{figure}

\todo{discuss the bit patterns}

\begin{algorithm}[H]
  \caption{Reading TGA 16-bit number.}
  \label{alg:read-16-bit-rgb}
  \begin{algorithmic}[1]
    \Let{$B$}{$data \BitAnd 31$}
    \Let{$G$}{$(data \BitAnd (31 \ShiftLeft 5)) \ShiftRight 5$}
    \Let{$R$}{$(data \BitAnd (31 \ShiftLeft 10)) \ShiftRight 10$}
    \Let{$A$}{$(data \BitAnd (1 \ShiftLeft 16)) \ShiftRight 16$}
  \end{algorithmic}
\end{algorithm}

\section{Gamma}

\cite{roelofs99:_png}
\cite{boutel:_png_portab_networ_graph_specif_version11}
\cite{boutel:_png_portab_networ_graph_specif_version1}
\cite{boutel:_png_portab_networ_graph_specif_version12}
\cite{Pascale2003_ReviewRGBColourSpaces}
\cite{srgb}

% not just dcecoration w3c guide.
\cite{lilley:_not_just_decor}

\cite{motta1991analytical_crt}

% poynton book
\cite{poynton2003digital}

In computer and television screens the color from them was output
using a technology known as a CRT(cathode-ray tube). Although they are
now getting replaced by LCDs(Liciud Crytal Displays). But while in the
following discussion we'll be refering to CRT, all of things said
about CRTs can also be said about CRT
\cite{hearn1997computer_graphics,roelofs99:_png}.

For the CRT to light out a color of certain luminance, say a very dim
red color, it has to be given a certain voltage $V$. After it is given
a certain voltage, a corresponding luminance $L$ is shone out from the
CRT. Now, it turns that the luminance $L$ is \textit{not} directly
proportional to the voltage $V$. That is, there exists no constant $k$
such that $L = kV$. It rather turns out that the relationship between
these two can be expressed in the form of a power law. A power law is
any function $f(x)$ that can be written on the form

\begin{equation*}
  f(x) = Cx^k
\end{equation*}

Where $C$ and $k$ are arbitrary constants (negative sign necessary?)\cite{newman05power,easley2010networks_powerlaw}.

So the relationship between $L$ and $V$ is \textit{not} $L = kL$ for
some constant $k$, but it is $L = CV^k$ for two constant $k$ and
$C$. It turns out that the value of the constant $C$ is $0$, so the
expression can be written on an simple form as $L =
V^k$. \cite{motta1991analytical_crt,Pascale2003_ReviewRGBColourSpaces,boutel:_png_portab_networ_graph_specif_version1,boutel:_png_portab_networ_graph_specif_version11,boutel:_png_portab_networ_graph_specif_version12,roelofs99:_png}.

In practically all digital image literature the constant $k$ is
assigned the letter $\gamma$, so we'll be using that letter from now
on. Our final expression for describing the relationship the emitted
luminosity $L$ and the inputted voltage $V$ is thus:

\begin{equation}
  \label{eq:gamma}
  L = V^\gamma
\end{equation}

The rest of this section is now spend on discussing the significance
of equation (\ref{eq:gamma}).

Real imaging systems will have several components, and more than one
of these can be nonlinear. If all of the components have transfer
characteristics that are power functions, then the transfer function
of the entire system is also a power function. The exponent (gamma) of
the whole system's transfer function is just the product of all of the
individual exponents (gammas) of the separate stages in the system.

Also, stages that are linear pose no problem, since a power function
with an exponent of 1.0 is really a linear function. So a linear
transfer function is just a special case of a power function, with a
gamma of 1.0.

Thus, as long as our imaging system contains only stages with linear
and power-law transfer functions, we can meaningfully talk about the
gamma of the entire system. This is indeed the case with most real
imaging systems.

\begin{Answer}[ref={rgb-triplet}]
  \begin{enumerate}[(a)]
  \item Blue
  \item Green
  \item Yellow
  \item White
  \item Black
  \item Cyan(light blue)
  \item Magenta(purplish red)
  \end{enumerate}
\end{Answer}

% crt gamma = 2.5

% endianess sources:
%file:///home/eric/Dropbox/freebooks/netghost.narod.ru/gff/graphics/book/ch06_01.htm
%http://www.ietf.org/rfc/ien/ien137.txt