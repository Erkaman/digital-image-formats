% fonts
\usepackage[T1]{fontenc}
%usepackage{inconsolata}
\usepackage[scaled=0.80]{luximono}

%\usepackage[charter]{mathdesign}
%\usepackage[notextcomp]{kpfonts}

% tgpagella doesn't have a math font.
\usepackage[sc]{mathpazo}
\usepackage{tgpagella}

%\usepackage{fouriernc}

\usepackage[
kerning,
spacing,
protrusion=true,
expansion=true]{microtype}
\microtypecontext{spacing=nonfrench}

% reduce section header spacing to save some poor trees.
%\usepackage[compact]{titlesec}
\interfootnotelinepenalty=10000

% color in table.
\usepackage[table]{xcolor}

% http://tex.stackexchange.com/questions/16061/includegraphics-pdf-color-problem
\pdfpageattr {/Group << /S /Transparency /I true /CS /DeviceRGB>>}


% fixes interaction between hyperref and algorithm
% see: http://geomblog.blogspot.com/2008/04/latex-hyperrefalgorithm-interaction.html
\usepackage{float}
% colored hyperlinks
%\usepackage[hyperindex,colorlinks]{hyperref}
\usepackage[]{hyperref}
%\hypersetup{colorlinks=false}
\usepackage{verbatim}

% SI units
\usepackage{siunitx}

% for leaving todonotes
\usepackage{todonotes}

% for \FloatBarrier macro
\usepackage[section]{placeins}

% professional looking tables.
\usepackage{booktabs}

% used in coding abbreviations.
\usepackage{etoolbox}

\usepackage{expl3}

% paths
\usepackage{path}

% controlling spaces in macros.
\usepackage{xspace}

% math
\usepackage{amsmath}

% for subfigures
\usepackage{subfig}

% string macros.
\usepackage{xstring}

% used for the very long ASCII table.
\usepackage{longtable}

\usepackage{multirow}

% for rotating a huge table.
\usepackage{rotating}

% customize table of contents.
\usepackage{tocstyle}
\usetocstyle{nopagecolumn}

% normal font
\settocfeature[toc][1]{entryhook}{\normalfont}
\settocfeature[toc][0]{entryhook}{\normalfont}

\usepackage{graphicx}
\newcommand\meddot{\scalebox{0.7}{\textbullet}}
\settocfeature{leaders}{\enskip\meddot\enskip}

% less detailed TOC, otherwise it ends up being WAY to long.
\setcounter{tocdepth}{1}

% more customizable lists.
\usepackage[shortlabels]{enumitem}

% exercises.
\usepackage{exercise,chngcntr}
\counterwithin{Exercise}{chapter}
\counterwithin{Answer}{chapter}

% typeset answers and exercises in a smaller font.
\makeatletter
\renewenvironment{Exercise}{\small\global\beginExerciseEnv}%
{\@ExeStaredfalse\endExerciseEnv}
\renewenvironment{Answer}{\small\beginAnswerEnv}{\endAnswerEnv}
\makeatother

% custom captions.
\usepackage{caption}
\captionsetup{
  margin=10pt,
  font=small,
  labelfont=bf,
  labelsep=endash,
  format=hang
}

% references
% references are ordered by the time they first appear.
\usepackage[sorting=none]{biblatex}

% tikz
\usepackage{tikz}
\usepackage{tikz-qtree}
\usetikzlibrary{positioning,fit,shadings,fadings,matrix,calc,patterns, shapes.multipart}

% algorithms typesetting.
\usepackage[chapter]{algorithm}
\usepackage{algpseudocode}

\newcommand{\commentsymbol}{$\triangleright$}
\algrenewcommand{\algorithmiccomment}[1]{\hfill\commentsymbol#1}
\newcommand{\linecomment}[1]{\State\commentsymbol#1}

\algrenewcommand\alglinenumber[1]{
  \tt\footnotesize\textcolor[HTML]{888888}{#1}}

\newcommand*\Let[2]{\State #1 $\gets$ #2}

\newcommand*\var[1]{\mathit{#1}}

\algblockdefx[REPEATN]
{Repeatn}
{EndRepeatn}
[1]{\algorithmicrepeat\ #1 \ \algorithmicdo}
{\algorithmicend \ \algorithmicrepeat}

\algnewcommand\algorithmicforeach{\textbf{for each}}

\newcommand{\algto}{\textbf{to}}

\algblockdefx[FOREACH]
{ForEach}
{EndForEach}
[2]{\algorithmicforeach \ #1 \ \textbf{in} \ #2 \algorithmicdo}
{\algorithmicend \ \algorithmicforeach}

\newcommand{\Break}{\State \textbf{break}}
\newcommand{\VoidCall}[1]{ \Call{#1}{\ensuremath{}}}
\newcommand{\ForTo}[3]{\For{ #1 $\gets$ #2 \algto\  #3}}

\newcommand{\EndForTo}{\EndFor}

\newcommand{\Ret}[1]{\State \textbf{return} #1}


\newcommand{\eof}{\VoidCall{EndOfFileReached}}
\newcommand{\neof}{$\NOT\VoidCall{\textsc{EndOfFileReached}}$}

% end algorithms macros.

% headers.
\usepackage{fancyhdr}

\pagestyle{fancy}

\renewcommand{\chaptermark}[1]{\markboth{\chaptername\ \thechapter\ -- \ #1}{}}

\lhead{}
\chead{}
\lhead{{\textit{\leftmark}}}
\rhead{\thepage}

\rfoot{}
\cfoot{}

% macros

\newcommand{\inputtikz}[1]{\input{tikz_img/#1}}

\newcommand{\True}{\textbf{true}\xspace}
\newcommand{\False}{\textbf{false}\xspace}
\newcommand{\NOT}{\neg}
\newcommand{\AND}{\wedge}
\newcommand{\OR}{\vee}
\newcommand{\mul}{\ensuremath{\cdot}}

\newcommand*\BitAnd{\mathrel{\&}}
\newcommand*\BitOr{\mathrel{|}}
\newcommand*\BitXor{\mathrel{\otimes}}
\newcommand*\ShiftLeft{\ll}
\newcommand*\ShiftRight{\gg}
\newcommand*\BitNeg{\ensuremath{\mathord{\sim}}}

\newcommand*{\tikzname}{Ti\emph{k}Z\xspace}

\newcommand{\fullbyte}{$11111111$\xspace}
\newcommand{\emptybyte}{$00000000$\xspace}

%\newcommand{\hex}[1]{\ensuremath{\mathrm{0x#1}}}
\newcommand{\hex}[1]{\mbox{\ensuremath{\mathrm{#1}_{16}}}}
\newcommand{\bin}[1]{\mbox{\ensuremath{#1_2}}}

\newcommand{\answers}{\section{Answers to the exercises}}

% LZ77 demonstration macros.

\ExplSyntaxOn
\cs_new_eq:NN \explRepeat \prg_replicate:nn
\ExplSyntaxOff

\makeatletter

\def\@filling#1{\phantom{\explRepeat{#1}{a}}}

\newcommand\@buffers[4]{%
  \node[
  rectangle split,
  rectangle split parts=2,
  draw,
  anchor=text,
  rectangle split horizontal]{%
    \@filling{#1}\texttt{#2}\nodepart{two}\texttt{#3}\@filling{#4}}
}

\newcommand{\@lzonestate}[2]{%
  \StrLen{#1}[\lena]%
  \newcount\cnta%
  \cnta\lena\relax%
  \advance\cnta by -\windowsize\relax
  \StrLen{#2}[\lenb]%
  \newcount\cntb%
  \cntb\lenb\relax%
  \advance\cntb by -\lookaheadsize\relax
  \@buffers{-\cnta}{#1}{#2}{-\cntb}
}

\newcommand\lzonetoken[3]{$(#1,#2,$\,{\tt#3}$)$}
\newcommand\lzonetokens[1]{\lzonetoken{0}{0}{#1}}

\newcommand{\lzonestate}[5]{%
\@lzonestate{#1}{#2}; \& \node[yshift=1mm]{$\Rightarrow$\lzonetoken{#3}{#4}{#5}}; \\}

\newcommand{\lzonestates}[3]{%
\@lzonestate{#1}{#2}; \& \node[yshift=1mm]{$\Rightarrow$
  \lzonetokens{#3}}; \\}

\newcommand{\lzonestatedots}{\node{$\vdots$}; \& \node{$\vdots$}; \\}

\def\lzonedem#1{%
  \begin{center}
  \begin{tikzpicture}[text height=1.5ex,text depth=.25ex]
    \matrix[ampersand replacement=\&,row sep=5mm]{#1};
  \end{tikzpicture}
  \end{center}}

\makeatother

\newcommand{\spc}{\char32}

% hyphenation
\hyphenation{Net-Sca-pe}
\hyphenation{brow-ser}
\hyphenation{Ha-ru-hi-ko}
\hyphenation{li-te-ral}

\newenvironment{huffman}
{\begin{tikzpicture}
    [level distance=10mm,
    % every node/.style={circle,inner sep=1pt,draw=black},
    hnode/.style={circle,inner sep=1pt,draw=black},
    level 1/.style={sibling distance=20mm},
    level 2/.style={sibling distance=10mm},
    level 3/.style={sibling distance=5mm},
    text height=1.5ex,text depth=.25ex]}{\end{tikzpicture}}


\newenvironment{huffmanc}
{\begin{center}\begin{huffman}}
    {\end{huffman}\end{center}}

\newcommand{\charnodeoffset}{1.0cm}

\newcommand{\nodechar}[2]{\node[below=of #1, yshift=\charnodeoffset] {\texttt{#2}};}

\newcommand{\firstcharnode}[3]{  \node (#1) [hnode] {#2};
  \nodechar{#1}{\texttt{#3}}}

\newcommand{\restcharnode}[4]{
  \node (#1) [hnode,right=of #2] {#3};
  \nodechar{#1}{\texttt{#4}}
}

% see http://www.latex-community.org/forum/viewtopic.php?f=5&t=6218&p=63092
\newcommand*\algohack{\addtocontents{loa}{\vskip 9pt}}

% Thanks to Philip and Konrad Rudolph:
% http://tex.stackexchange.com/questions/2933/parse-comma-separated-list-of-command-names-with-spaces

\newcommand*\acronymstyle{\scshape}
\newcommand*\newacronym[1]{
  \expandafter\newcommand\csname#1\endcsname[1][]{{\acronymstyle#1}##1\xspace}}

\newcommand*{\newacronyms}{%
  \let\do\newacronym
  \docsvlist
}
\newacronyms{pgf,im,ascii,exif,tga,gif,png,crc,gcc,emacs,git,rle,lzw,lzss,
nul, soh,stx,lf,rgb,rgba, argb,gimp,lzma,
etx,eot,enq,ack,bel,bs,vt,ff,dle,nak,syn,etb,can,sub,esc,fs,gs,rs,us,del,
zlib,mime,stmp,ihdr,plte,idat,iend,
cmf,cm,cinfo,flg}

% LZ77 and LZ78 are sometimes also referred to as LZ1 and LZ2.
\newcommand*{\lzone}{{\acronymstyle lz\oldstylenums{77}}\xspace}
\newcommand*{\lztwo}{{\acronymstyle lz\oldstylenums{78}}\xspace}

% \cr and \ht are already defined.
\newcommand*{\cret}{{\acronymstyle cr}\xspace}
\newcommand*{\htab}{{\acronymstyle ht}\xspace}
\newcommand*{\nullm}{{\acronymstyle null}\xspace}
\newcommand*{\lzfam}{{\acronymstyle lz}-family\xspace}
\newcommand*{\sout}{{\acronymstyle so}\xspace}
\newcommand*{\shiftin}{{\acronymstyle si}\xspace}
\newcommand*{\emed}{{\acronymstyle em}\xspace}

\newcommand*{\crlf}{{\acronymstyle crlf}\xspace}


\newcommand*{\dc}[1]{{\acronymstyle dc#1}\xspace}

% sixteen
\newcommand*{\crcst}{{\acronymstyle crc-16}\xspace}

\newcommand{\deflate}{Deflate\xspace}

% working samepage.
\newenvironment{samepagew}{\begin{minipage}{\textwidth}}{\end{minipage}}

% % Fixes list of algorithms formatting.
% % Thanks Dan: http://newsgroups.derkeiler.com/Archive/Comp/comp.text.tex/2005-10/msg01179.html
% \makeatletter
% \let\l@algorithm\l@figure
% \makeatother

% \renewcommand{\listofalgorithms}{\begingroup
% \tocfile{List of Algorithms}{loa}
% \endgroup}
